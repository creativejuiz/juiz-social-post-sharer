<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Source: utilities.php - Juiz Social Post Sharer Documentation</title>
       
        <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
        <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
    </head>

    <body>
        <div class="app">
            <section role="main" id="main">

                <h1 class="page-title">Source: utilities.php</h1>

                


    
    <section role="main">
        <pre class="prettyprint source linenums"><code>&lt;?php if ( ! defined( 'ABSPATH' ) ) {
	die( 'Cheatin&amp;#8217; uh?' );
}


if ( ! function_exists( 'juiz_sf_get_current_url' ) ) {
	/**
	 * Get the real current page URL.
	 *
	 * @param  (string) $mode  The mode of the URL.
	 * @return (string)        The current page URL.
	 *
	 * @since  2.0.0
	 * @author BoiteAWeb.fr, Geoffrey Crofte
	 * @see http://boiteaweb.fr/sf_get_current_url-obtenir-url-courante-fonction-semaine-5-6765.html
	 */
	function juiz_sf_get_current_url( $mode = 'base' ) {
		
		$url = 'http' . ( is_ssl() ? 's' : '' ) . '://' . $_SERVER['HTTP_HOST'] . $_SERVER['REQUEST_URI'];
		
		switch ( $mode ) {
			case 'raw' :
				return $url;
				break;
			case 'base' :
				return reset( explode( '?', $url ) );
				break;
			case 'uri' :
				$exp = explode( '?', $url );
				return trim( str_replace( home_url(), '', reset( $exp ) ), '/' );
				break;
			default:
				return false;
		}
	}
}

if ( ! function_exists( 'juiz_sps_get_ordered_networks') ) {
	/**
	 * Get the user-ordered list of networks.
	 *
	 * @param  (array) $networks A formated list of network (backward compatible before 2.0.0)
	 * @param  (array) $order    A list of network slugs.
	 * 
	 * @return (array)           An exploitable ordered list of networks.
	 * 
	 * @since  2.0.0
	 * @author Geoffrey Crofte
	 */
	function juiz_sps_get_ordered_networks( $networks, $order ) {
		$order = isset( $order ) &amp;&amp; is_array( $order ) ? $order : null;

		// Sort networks by user choice order.
		// @see: https://stackoverflow.com/questions/348410/sort-an-array-by-keys-based-on-another-array/9098675#9098675
		return $order !== null ? array_replace( array_flip( $order ), $networks ) : $networks;
	}
}

if ( ! function_exists('juiz_sps_get_notification_markup') ) {
	/**
	 * Print the HTML code needed for JS notifications.
	 * 
	 * @return void
	 *
	 * @since  2.0.0
	 * @author Geoffrey Crofte
	 */
	function juiz_sps_get_notification_markup() {
		?>

		&lt;div class="juiz-sps-notif">
			&lt;div class="juiz-sps-notif-icon">
				&lt;i class="dashicons" role="presentation">&lt;/i>
			&lt;/div>
			&lt;p class="juiz-sps-notif-text">&lt;/p>
		&lt;/div>

		&lt;?php
	}
}

if ( ! function_exists('juiz_sps_get_skin_css_name') ) {
	/**
	 * Return the name of the CSS file name for Button Skins
	 * 
	 * @return (string) The name of the file.
	 *
	 * @since  2.0.0
	 * @author Geoffrey Crofte
	 */
	function juiz_sps_get_skin_css_name() {
		return 'styles.css';
	}
}

if ( ! function_exists('juiz_sps_get_skin_img_name') ) {
	/**
	 * Return the name of the image name for Button Skins
	 * 
	 * @return (string) The name of the file.
	 *
	 * @since  2.0.0
	 * @author Geoffrey Crofte
	 */
	function juiz_sps_get_skin_img_name() {
		return 'screenshot.png';
	}
}

if ( ! function_exists('juiz_sps_remove_old_networks') ) {
	/**
	 * Return an array of networks without the old ones.
	 * 
	 * @return (array) The cleaned array
	 *
	 * @since  2.0.0
	 * @author Geoffrey Crofte
	 */
	function juiz_sps_remove_old_networks( $networks ) {
		unset( $networks['delicious']   );
		unset( $networks['digg']        );
		unset( $networks['stumbleupon'] );
		unset( $networks['google']      );

		return $networks;
	}
}

if ( ! function_exists( 'jsps_get_all_registered_networks' ) ) {
	/**
	 * Return a merged array of custom and core networks.
	 * 
	 * @return (array) The merged array.
	 *
	 * @since  2.0.0
	 * @author Geoffrey Crofte
	 */
	function jsps_get_all_registered_networks() {
		$custom_networks = jsps_get_custom_networks();
		$core_networks   = jsps_get_core_networks();

		return array_merge( $custom_networks, $core_networks );
	}
}

if ( ! function_exists( 'jsps_get_displayable_networks' ) ) {
	/**
	 * Get an array of exploitable ordered list of networks for front and admin purpose
	 *
	 * @param  (array) $networks A formated list of network (backward compatible before 2.0.0)
	 * @param  (array) $order    A list of network slugs.
	 * 
	 * @return (array)           An exploitable ordered list of networks.
	 * 
	 * @since  2.0.0
	 * @author Geoffrey Crofte
	 */
	function jsps_get_displayable_networks( $networks, $order ) {
		
		$core_networks   = jsps_get_core_networks();
		$custom_networks = jsps_get_custom_networks();

		// Backward compatibility / Conversion
		$reformated_old_list = array();
		if ( isset( $networks['google'] ) ) {
			foreach ( $networks as $k => $v ) {
				$reformated_old_list[ $k ] = array(
					'name' => $v[1],
					'visible' => $v[0],
				);
			}
			
			$reformated_old_list = juiz_sps_remove_old_networks( $reformated_old_list );
		}

		// Merge old list with the new registered core networks
		// To keep options of the users.
		$merged_core_networks = array_replace( $core_networks, $reformated_old_list );

		// Merge Custom and Core Networks, Core has the priority here.
		$merged_networks = array_merge( $custom_networks, $core_networks );

		// Merge Options registered by user with complete list
		if ( ! isset( $networks['google'] ) ) {
			$merged_networks = array_merge( $merged_networks, $networks );
		}

		$dnetworks = juiz_sps_get_ordered_networks( $merged_networks, $order );
		$dnetworks = juiz_sps_remove_old_networks( $dnetworks );

		/**
		 * Gets an ordered list of networks.
		 *
		 * This filter comes at the end of the aponymous function that insures the backward compatibility with options (before 2.0.0), merges the users options and orders the networks regarding the user's preferences.
		 * 
		 * @hook jsps_get_displayable_networks
		 * 
	 	 * @since  2.0.0 First version
	 	 * 
	 	 * @param  {array}  dnetworks              - The merges and ordered array of networks.
	 	 * @param  {array}  dnetworks.slug         - An array of data for the `slug` network.
	 	 * @param  {string} dnetworks.slug.name    - The name of the network.
	 	 * @param  {int}    dnetworks.slug.visible - Is the network visible at plugin install? (`1` for yes, `0` for no)
	 	 * @param  {string} dnetworks.slug.api_url - The API URL for custom (not core) network.
	 	 * @param  {string} dnetworks.slug.icon    - An URL to a SVG file, or a classname.
	 	 * @param  {string} dnetworks.slug.title   - The text for the link tooltip (title attribute)
	 	 * @param  {string} dnetworks.slug.color   - The main color of this network (`color` valid value)
	 	 * @param  {string} dnetworks.slug.hcolor  - The :hover color of this network (`color` valid value)
	 	 * 
	 	 * @param  {array} $networks    The array of networks before cleaning up.
	 	 * @param  {array} $order       A simple array of the network slugs (e.i `array('weibo', 'twitter')`) in the order decided by the user.
	 	 *
	 	 * 
	 	 * @return {array} The array of network ready to be used. See $dnetworks for the structure.
	 	 *
		 */
		return apply_filters( 'jsps_get_displayable_networks', $dnetworks, $networks, $order );
	}
}

if ( ! function_exists('jsps_get_excerpt') ) {
	/**
	 * Get an excerpt from the post_content
	 * @param  (object) $post   The WP Post object.
	 * @param  (int)    $count  The number of letter needed.
	 * @return (string)         The excerpt.
	 *
	 * @since  2.0.0
	 * @author Geoffrey Crofte
	 */
	function jsps_get_excerpt( $post, $count = 80 ) {

		/**
		 * **Before altering the content** and getting an excerpt from the `$post->post_content`.
	 	 * 
	 	 * @hook jsps_before_get_excerpt
		 * 
	 	 * @since  2.0.0
		 * 
	 	 * @param  {object} $post        The WP Post object.
	 	 * @param  {int=}   [$count=80]  The number of letters needed.
	 	 *
		 */
		do_action( 'jsps_before_get_excerpt', $post, $count );

		$count = apply_filters( 'jsps_get_excerpt_letter_count', $count );
		$text  = wordwrap( wp_strip_all_tags( $post->post_content ), (int) $count, "***", true );
		$tcut  = explode("***", $text);

		/**
		 * Gets an excerpt from the `$post->post_content` based on the number of letter requested (`$count`), mostly used for Share APIs that use long text.
		 * 
		 * @hook jsps_get_excerpt
		 * 
	 	 * @since  2.0.0 First version
	 	 * 
	 	 * @param  {object} $content The post_content shortened.
	 	 * @param  {int=}   [$count=80]   The number of letters requested.
	 	 *
	 	 * @param {object}  employees - The employees who are responsible for the project.
 		 * @param {string}  employees.name - The name of an employee.
	 	 * 
	 	 * @return {string}          The shortened content used as excerpt
	 	 *
		 */
		return apply_filters( 'jsps_get_excerpt', $tcut[0], $count );
	}
}

if ( ! function_exists('jsps_get_network_html_icon') ) {
	/**
	 * Get the HTML code for the icon. Used in admin and front.
	 *
	 * @param  (string)  $slug         The network shortname (e.i `twitter`).
	 * @param  (array)   $network_info The info regarding the network.
	 * @param  (boolean) $is_front     Is it used for front or admin? (default: false)
	 * @return (string)                Return void if front and not custom network. Return default admin icon `&lt;i>` tag, or `&lt;svg>` icon if custom network with file, return `&lt;i>` with custom class if it's a custom network with class.
	 *
	 * @since  2.0.0
	 * @author Geoffrey Crofte
	 */
	function jsps_get_network_html_icon($slug, $network_info, $is_front = false) {
		
		if ( $is_front &amp;&amp; ! isset( $network_info['icon'] ) ) return;

		$icon = '&lt;i class="jsps-icon-' . esc_attr( $slug ) . '" role="presentation">&lt;/i>';
		
		if ( ! isset( $network_info['icon'] ) ) return $icon;
			
		if ( filter_var( $network_info['icon'], FILTER_VALIDATE_URL ) ) {
			$svg_file = file_get_contents( $network_info['icon'] );
			$svg_file = substr( $svg_file, strpos( $svg_file, '&lt;svg' ) );


			$icon = $is_front ? $svg_file : '&lt;i>' . $svg_file . '&lt;/i>';
		} else {
			$icon = '&lt;i class="jsps-icon-' . esc_attr( $slug ) . ' ' . esc_attr( $network_info['icon'] ) . '" role="presentation">&lt;/i>';
		}

		return apply_filters( 'jsps_get_network_html_icon', $icon, $slug, $network_info, $is_front );
	}
}

if ( ! function_exists( 'jsps_render_api_link' ) ) {
	/**
	 * Format the custom network API link for front usage.
	 * %%title%%, %%excerpt%% and %%url%% variables within the API URL will be replaced by correspondig post-to-be-shared element.
	 * 
	 * @param  (array)  $infos Information about the post and network (api, url, title, desc)
	 * @return (string)        Return the formatted URL.
	 *
	 * @since  2.0.0
	 * @author Geoffrey Crofte
	 */
	function jsps_render_api_link( $infos ) {

		// Need at least the API and URL infos.
		if ( ! isset( $infos['api'], $infos['url'] ) ) return;

		// If we don't find %% within the API URL, return it like it is.
		if ( ! strpos( $infos['api'], '%%' ) ) return $infos['api'];

		// Otherwise replace %% variables.
		$url = preg_replace(
			array(
				'#%%title%%#',
				'#%%excerpt%%#',
				'#%%url%%#'
			),
			array(
				isset( $infos['title'] ) ? $infos['title'] : '',
				isset( $infos['desc'] )  ? $infos['desc']  : '',
				isset( $infos['url'] )   ? $infos['url']   : ''
			),
			$infos['api']
		);

		return apply_filters( 'jsps_render_api_link', $url, $infos );
	}
}

/**
 * A function that return the old network array option (before v2.0.0)
 * Used for debug purpose.
 *
 * @return (array) The old array of network options
 * 
 * @since  2.0.0
 * @author Geoffrey Crofte
 */
function jsps_get_old_network_array() {
	return array(
		'delicious'		=>	array( 0, 'Delicious' ), // new 1.4.1
		'digg'			=>	array( 0, 'Digg' ),
		'facebook'		=>	array( 1, 'Facebook' ), 
		'google'		=>	array( 0, 'Google+' ),
		'linkedin'		=>	array( 0, 'LinkedIn' ),
		'pinterest'		=>	array( 0, 'Pinterest' ),
		'reddit'		=>	array( 0, 'Reddit' ), // new 1.4.1
		'stumbleupon'	=>	array( 0, 'StumbleUpon' ),
		'twitter'		=>	array( 1, 'Twitter' ), 
		'tumblr'		=>	array( 0, 'Tumblr' ), // new 1.4.1
		'viadeo'		=>	array( 0, 'Viadeo' ),
		'vk'			=>	array( 0, 'VKontakte' ), // new 1.3.0
		'weibo'			=>	array( 0, 'Weibo' ), // new 1.2.0
		'mail'			=>	array( 1, 'Email' ),
		'bookmark'		=>	array( 0, 'Bookmark' ), // new 1.4.2
		'print'			=>	array( 0, 'Print' ) // new 1.4.2
	);
}</code></pre>
    </section>




            </section>
            <nav role="navigation">
                <ul>
					<li class="nav-item-home"><a href="index.html"><img src="images/social-post-sharer-logo-horiz.svg" width="248" height="48" alt="Home - Social Post Sharer Doc."></a></li>
					<li class="nav-item-actions">
						<span class="sub-item"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M18 12H15.82C15.65 12.7 15.38 13.35 15.01 13.93L16.55 15.47L14.45 17.57L12.91 16.03C12.33 16.39 11.68 16.66 11 16.82V19H8V16.82C7.32 16.66 6.67 16.39 6.09 16.03L4.55 17.57L2.43 15.45L3.97 13.91C3.61 13.33 3.34 12.68 3.18 12H1V9.03H3.17C3.33 8.33 3.61 7.68 3.97 7.09L2.43 5.55L4.53 3.45L6.07 4.99C6.65 4.62 7.31 4.35 8 4.18V2H11V4.18C11.68 4.34 12.33 4.61 12.91 4.97L14.45 3.43L16.57 5.55L15.03 7.09C15.39 7.68 15.67 8.33 15.83 9.03H18V12ZM9.5 13.5C11.16 13.5 12.5 12.16 12.5 10.5C12.5 8.84 11.16 7.5 9.5 7.5C7.84 7.5 6.5 8.84 6.5 10.5C6.5 12.16 7.84 13.5 9.5 13.5Z" fill="currentColor"/></svg>Actions</span>
						<ul>
							<li class="here-2-jsps_before_get_excerpt-[object Object]"><a href="jsps_before_get_excerpt.html">jsps_before_get_excerpt</a></li>
						</ul>
					</li>
					<li class="nav-item-filters">
						<span class="sub-item"><svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M3 4.5V2.5C3 2.5 6.34 1.5 10 1.5C13.66 1.5 17 2.5 17 2.5V4.5L12 11.53V18.5C12 18.5 10.78 18.41 9.75 17.91C8.72 17.41 8 16.5 8 16.5V11.53L3 4.5Z" fill="currentColor"/></svg>Filters</span>
						<ul>
							<li class="here-2-jsps_get_displayable_networks-[object Object]"><a href="jsps_get_displayable_networks.html">jsps_get_displayable_networks</a></li>
								<li class="here-2-jsps_get_excerpt-[object Object]"><a href="jsps_get_excerpt.html">jsps_get_excerpt</a></li>
						</ul>
					</li>
				</ul>
            </nav>
        </div>
        
        <script src="scripts/juiz.js" defer></script>
        <script src="scripts/prettify/prettify.js" defer></script>
        <script src="scripts/prettify/lang-css.js" defer></script>
        <script>
            let launch = setInterval(function(){
                if (typeof prettyPrint === 'function' ) {
                    prettyPrint();
                    clearInterval(launch);
                    launch = null;
                }
            }, 50);
        </script>
        <script src="scripts/linenumber.js" defer></script>
    </body>
</html>